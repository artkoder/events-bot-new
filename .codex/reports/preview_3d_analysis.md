**–ß—Ç–æ –∏–º–µ–Ω–Ω–æ –ª–æ–º–∞–µ—Ç—Å—è (–ø–æ —Ñ–∞–∫—Ç—É –∫–æ–¥–∞)**
- –ù–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø—É—Ç–∏ dataset: —Ö—ç–Ω–¥–ª–µ—Ä —Å–æ–∑–¥–∞—ë—Ç slug `preview3d-{session_id}`, –∞ –Ω–æ—É—Ç–±—É–∫ —á–∏—Ç–∞–µ—Ç –∂—ë—Å—Ç–∫–æ `"/kaggle/input/preview3d-dataset/payload.json"` ‚Üí `kaggle/Preview3D/preview_3d.ipynb:56`, –ø–æ—ç—Ç–æ–º—É `payload.json` –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è.
- ‚Äú–¢–∏—Ö–∞—è‚Äù —É—Å–ø–µ—à–Ω–∞—è –æ—Ç—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ—É—Ç–±—É–∫–∞: `load_payload()` –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ñ–∞–π–ª–∞ –ø–µ—á–∞—Ç–∞–µ—Ç –æ—à–∏–±–∫—É –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `[]` ‚Üí `kaggle/Preview3D/preview_3d.ipynb:79`, –∏–∑-–∑–∞ —á–µ–≥–æ kernel –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è `COMPLETE`, –ø–∏—à–µ—Ç `output.json` —Å `total=0` ‚Üí `kaggle/Preview3D/preview_3d.ipynb:539`, –∏ –±–æ—Ç —Å—á–∏—Ç–∞–µ—Ç –∑–∞–¥–∞—á—É —É—Å–ø–µ—à–Ω–æ–π.
- –°—Ç–∞—Ç—É—Å –≤ Telegram –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è: `_poll_kaggle_kernel` –º–µ–Ω—è–µ—Ç —Ç–æ–ª—å–∫–æ `_active_sessions`, –Ω–æ –Ω–µ –¥–µ–ª–∞–µ—Ç `bot.edit_message_text` ‚Üí `preview_3d/handlers.py:178`; –∫–Ω–æ–ø–∫–∞ ‚ÄúüîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å‚Äù –æ—Ç–≤–µ—á–∞–µ—Ç –≤—Å–ø–ª—ã–≤–∞—à–∫–æ–π, –Ω–æ –Ω–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Üí `preview_3d/handlers.py:416`.
- –°–∫—Ä—ã—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏/–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç–∏:
  - –í—ã–≥—Ä—É–∑–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –æ–±—â–∏–π `/tmp/preview3d_output` –º–æ–∂–µ—Ç –ø–µ—Ä–µ—Ç–∏—Ä–∞—Ç—å—Å—è –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏ ‚Üí `preview_3d/handlers.py:203`.
  - Kernel –ø—É—à–∏—Ç—Å—è –≤ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π slug/id (`preview-3d`), –∞ `dataset_sources` –ø–æ–¥–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ –ª–µ—Ç—É ‚Üí –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ –∑–∞–ø—É—Å–∫–∏ –º–æ–≥—É—Ç ‚Äú–ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å‚Äù –¥–∞—Ç–∞—Å–µ—Ç –¥—Ä—É–≥ –¥—Ä—É–≥—É ‚Üí `preview_3d/handlers.py:159`.

**–í–∞—Ä–∏–∞–Ω—Ç—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è**
- –í–∞—Ä–∏–∞–Ω—Ç A (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∫–∏, –±—ã—Å—Ç—Ä–æ): –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–π pipeline (dataset per session ‚Üí kernel push ‚Üí poll ‚Üí download output.json), –Ω–æ —Ñ–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç ‚Äúkernel ‚Üî –±–æ—Ç‚Äù –∏ –¥–æ–±–∞–≤–∏—Ç—å –∂–∏–≤—ã–µ –∞–ø–¥–µ–π—Ç—ã —Å—Ç–∞—Ç—É—Å–∞.
- –í–∞—Ä–∏–∞–Ω—Ç B (—Å—Ä–µ–¥–Ω–∏–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä, –ª—É—á—à–µ –∫–∞—á–µ—Å—Ç–≤–æ): –≤—ã–Ω–µ—Å—Ç–∏ –æ–±—â–∏–π ‚ÄúKaggle job runner/poller‚Äù –ø–æ –æ–±—Ä–∞–∑—Ü—É `video_announce/poller.py` (—Ç–∞–º —É–∂–µ –µ—Å—Ç—å —É—Å—Ç–æ–π—á–∏–≤—ã–π polling, message update, —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –ª–æ–≥–æ–≤) –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è `preview_3d`.
- –í–∞—Ä–∏–∞–Ω—Ç C (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å): –¥–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å—é:
  - C1: —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è (–æ–¥–Ω–∞ –∑–∞–¥–∞—á–∞ Preview3D –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ) —á–µ—Ä–µ–∑ `asyncio.Lock` ‚Äî –ø—Ä–æ—â–µ –≤—Å–µ–≥–æ, —É–±–∏—Ä–∞–µ—Ç –≥–æ–Ω–∫–∏ kernel push.
  - C2: —É–Ω–∏–∫–∞–ª—å–Ω—ã–π kernel –Ω–∞ —Å–µ—Å—Å–∏—é (`preview-3d-{session_id}`) + –∞–≤—Ç–æ-–æ—á–∏—Å—Ç–∫–∞ ‚Äî –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ, –Ω–æ —Å–ª–æ–∂–Ω–µ–µ –∏ –º–æ–∂–µ—Ç —É–ø–µ—Ä–µ—Ç—å—Å—è –≤ –ª–∏–º–∏—Ç—ã/–º—É—Å–æ—Ä –≤ Kaggle.

**–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–∞—è —Ü–µ–ª–µ–≤–∞—è ‚Äú–∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω–∞—è‚Äù —Å—Ö–µ–º–∞**
- –ù–æ—É—Ç–±—É–∫ —Å–∞–º –Ω–∞—Ö–æ–¥–∏—Ç payload (–Ω–µ –∑–Ω–∞–µ—Ç slug –∑–∞—Ä–∞–Ω–µ–µ), –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –≤—Ö–æ–¥ –∏ ‚Äúfail fast‚Äù.
- `output.json` –≤—Å–µ–≥–¥–∞ –∏–º–µ–µ—Ç —è–≤–Ω—ã–π `status` (`ok|error`) + `meta` (—Å–∫–æ–ª—å–∫–æ —Å–æ–±—ã—Ç–∏–π –æ–∂–∏–¥–∞–ª–æ—Å—å/–æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ, –∫–∞–∫–æ–π payload –Ω–∞–π–¥–µ–Ω), —á—Ç–æ–±—ã –±–æ—Ç –º–æ–≥ –æ—Ç–ª–∏—á–∞—Ç—å ‚Äú–Ω–∏—á–µ–≥–æ –Ω–µ —Å–¥–µ–ª–∞–ª–∏‚Äù –æ—Ç ‚Äú–≤—Å—ë –æ–∫‚Äù.
- –ë–æ—Ç –æ–±–Ω–æ–≤–ª—è–µ—Ç –æ–¥–Ω–æ Telegram-—Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ —Å—Ç–∞–¥–∏—è–º: `preparing ‚Üí dataset ‚Üí kernel_push ‚Üí kaggle:{running|complete|failed} ‚Üí download ‚Üí apply_results ‚Üí done/error`.

**–ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π (–ø–æ —à–∞–≥–∞–º)**
1. –ù–æ—É—Ç–±—É–∫: –∑–∞–º–µ–Ω–∏—Ç—å `PAYLOAD_FILE` –Ω–∞ –ø–æ–∏—Å–∫ `Path("/kaggle/input").rglob("payload.json")` –∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ –¥–µ–ª–∞—Ç—å `raise/SystemExit(1)` (–∏/–∏–ª–∏ –ø–∏—Å–∞—Ç—å `output.json` —Å–æ `status="error"`), —É–±—Ä–∞—Ç—å –≤–æ–∑–≤—Ä–∞—Ç `[]` –∫–∞–∫ ‚Äú—É—Å–ø–µ—Ö‚Äù ‚Üí `kaggle/Preview3D/preview_3d.ipynb:56`, `kaggle/Preview3D/preview_3d.ipynb:79`.
2. –ë–æ—Ç-—Ö—ç–Ω–¥–ª–µ—Ä: –¥–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∏ –≤—ã–∑—ã–≤–∞—Ç—å `bot.edit_message_text` –ø—Ä–∏ —Å–º–µ–Ω–µ `session["status"]` (–≤–∫–ª—é—á–∞—è polling-—Ü–∏–∫–ª) ‚Üí `_poll_kaggle_kernel` `preview_3d/handlers.py:178`, `_run_kaggle_render` `preview_3d/handlers.py:231`.
3. ‚ÄúüîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å‚Äù: —Å–¥–µ–ª–∞—Ç—å –Ω–µ `callback.answer(...)`, –∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (—Å fallback –Ω–∞ `answer` –ø—Ä–∏ –æ—à–∏–±–∫–µ Telegram) ‚Üí `preview_3d/handlers.py:416`.
4. –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞: –µ—Å–ª–∏ `event_count > 0`, —Ç–æ –æ–∂–∏–¥–∞—Ç—å `len(results) == event_count` (–¥–∞–∂–µ `skip` ‚Äî —ç—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç); –∏–Ω–∞—á–µ —Å—á–∏—Ç–∞—Ç—å —ç—Ç–æ –æ—à–∏–±–∫–æ–π –ø–∞–π–ø–ª–∞–π–Ω–∞ –∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é/–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å.
5. –†–∞–∑–≤–µ—Å—Ç–∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –ø–æ —Å–µ—Å—Å–∏—è–º: —É–Ω–∏–∫–∞–ª—å–Ω–∞—è –ø–∞–ø–∫–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è output (`/tmp/preview3d-{session_id}`) –∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) —É–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.
6. –í—ã–±—Ä–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç–∏: –º–∏–Ω–∏–º—É–º ‚Äî –≥–ª–æ–±–∞–ª—å–Ω—ã–π lock –¥–ª—è Preview3D; –º–∞–∫—Å–∏–º—É–º ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π kernel per session (–µ—Å–ª–∏ —Ä–µ–∞–ª—å–Ω–æ –Ω—É–∂–µ–Ω –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º).

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å ‚Äî —Å–¥–µ–ª–∞—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –ø–æ –≤–∞—Ä–∏–∞–Ω—Ç—É A (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∫–∏) –∏–ª–∏ B (–ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–¥—Ö–æ–¥ `video_announce/poller.py`) –∏ –ø—Ä–æ–≥–æ–Ω—é –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ —Ñ–æ—Ä–º–∞—Ç `output.json`/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞.