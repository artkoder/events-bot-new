**Phase 1 ‚Äî –ê–Ω–∞–ª–∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã**
- `build_weekend_page_content` —Å–æ–±–∏—Ä–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –ø–æ –¥–Ω—è–º + –æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã—Å—Ç–∞–≤–∫–∏, –≤—ã–∑—ã–≤–∞–µ—Ç `ensure_event_telegraph_link`, —Å—Ç—Ä–æ–∏—Ç –∫–æ–Ω—Ç–µ–Ω—Ç —á–µ—Ä–µ–∑ `add_day_sections` –∏ –º–µ—Ä—è–µ—Ç —Ä–∞–∑–º–µ—Ä —á–µ—Ä–µ–∑ `rough_size`; —Ö–æ—Ä–æ—à–∞—è –æ–ø–æ—Ä–∞ –¥–ª—è /special –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —Ä–µ–Ω–¥–µ—Ä–∞ –∏ –ª–∏–º–∏—Ç–∞–º (`main_part2.py`, `main.py`).
- `event_to_nodes` –±–µ—Ä–µ—Ç `format_event_md`, –ø–∞—Ä—Å–∏—Ç –≤ Telegraph‚Äënodes, —É–º–µ–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—é —Å–≤–µ—Ä—Ö—É —á–µ—Ä–µ–∑ `photo_urls`, –∏ –∑–∞–≤–µ—Ä—à–∞–µ—Ç –±–ª–æ–∫ `telegraph_br` (`main_part2.py`, `event_utils.py`).
- `weekendimg` ‚Äî —Ä–µ—Ñ–µ—Ä–µ–Ω—Å –¥–ª—è —à–∞–≥–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±–ª–æ–∂–∫–∏: –≤—ã–±–æ—Ä –¥–∞—Ç—ã —á–µ—Ä–µ–∑ inline‚Äë–∫–Ω–æ–ø–∫–∏, –æ–∂–∏–¥–∞–Ω–∏–µ —Ñ–æ—Ç–æ, `extract_images` + `upload_images`, –∑–∞–ø–∏—Å—å –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –ø–æ—Å–ª–µ–¥—É—é—â–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (`main_part2.py`, `main.py`).
- –õ–∏–º–∏—Ç—ã: `TELEGRAPH_LIMIT` –∏ `rough_size` —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü –∏ –Ω—É–∂–Ω—ã –∫–∞–∫ —á–∞—Å—Ç—å —Ü–∏–∫–ª–∞ ¬´—É—Ä–µ–∑–∞—Ç—å –ø–µ—Ä–∏–æ–¥¬ª (`main.py`).
- FSM —É–∂–µ –µ—Å—Ç—å –∫–∞–∫ –ø–∞—Ç—Ç–µ—Ä–Ω –≤ `handlers/ik_poster_cmd.py`; –ø—Ä–∏ —ç—Ç–æ–º —á–∞—Å—Ç—å —Ñ–ª–æ—É —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ TTL‚Äë—Å–ª–æ–≤–∞—Ä–∏–∫–∏ –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ (`main.py`, `handlers/ik_poster_cmd.py`).

- –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π –æ—Ç—á—ë—Ç: –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã —Ç–æ—á–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å—ã –¥–ª—è /special (—Ä–µ–Ω–¥–µ—Ä —Å–æ–±—ã—Ç–∏–π, –∑–∞–≥—Ä—É–∑–∫–∞ –æ–±–ª–æ–∂–∫–∏, –ª–∏–º–∏—Ç Telegraph).

**Phase 2 ‚Äî –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏**
- –ö–ª—é—á –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏: `(date, normalized_title)`; `normalized_title = casefold + strip + collapse spaces + remove leading emoji`, —á—Ç–æ–±—ã ¬´üé≠ –°–ø–µ–∫—Ç–∞–∫–ª—å¬ª –∏ ¬´–°–ø–µ–∫—Ç–∞–∫–ª—å¬ª —Å—á–∏—Ç–∞–ª–∏—Å—å –æ–¥–Ω–∏–º.
- –î–∞—Ç–∞ –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏: `parse_iso_date(e.date.split("..", 1)[0])`, —á—Ç–æ–±—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω—ã.
- –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã–π –∞–≥—Ä–µ–≥–∞—Ç:
  - `SpecialEventGroup`: `day`, `title`, `description_or_digest`, `location_*`, `photo_url`, `link_url`, `ics_url`, `slots`.
  - `SpecialEventSlot`: `time`, `ticket_line`, `source_event`.
- `description_or_digest`: –µ—Å–ª–∏ `description` –ø—É—Å—Ç–æ–π ‚Äî –±—Ä–∞—Ç—å `search_digest`.
- `photo_url`: –ø–µ—Ä–≤—ã–π –≤–∞–ª–∏–¥–Ω—ã–π `photo_urls[0]` —Å—Ä–µ–¥–∏ —Å–æ–±—ã—Ç–∏–π –≥—Ä—É–ø–ø—ã.
- `link_url`: –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç `telegraph_url` ‚Üí `telegraph_path` ‚Üí `source_post_url`; `ics_url` ‚Äî `ics_url` –∏–ª–∏ `ics_post_url`.
- `ticket_line`: –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ö–µ–ª–ø–µ—Ä –Ω–∞ –±–∞–∑–µ –ª–æ–≥–∏–∫–∏ –∏–∑ `format_event_md` (–±–µ—Å–ø–ª–∞—Ç–Ω–æ/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/—Ü–µ–Ω—ã/–ø—Ä–æ–¥–∞–Ω—ã), –Ω–æ –±–µ–∑ –¥–ª–∏–Ω–Ω—ã—Ö –ø–æ—è—Å–Ω–µ–Ω–∏–π.
- `slots` —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –≤—Ä–µ–º–µ–Ω–∏; –µ—Å–ª–∏ –≤—Ä–µ–º—è –Ω–µ –∑–∞–¥–∞–Ω–æ ‚Äî —Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ `None` –∏ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å ¬´–≤—Ä–µ–º—è —É—Ç–æ—á–Ω—è–µ—Ç—Å—è¬ª –ª–∏–±–æ –±–µ–∑ –≤—Ä–µ–º–µ–Ω–∏.

- –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π –æ—Ç—á—ë—Ç: –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ —Å—Ö–µ–º–∞ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –∏ –ø—Ä–∞–≤–∏–ª–∞ –≤—ã–±–æ—Ä–∞ –æ–ø–∏—Å–∞–Ω–∏—è/—Å—Å—ã–ª–æ–∫/–∫–∞—Ä—Ç–∏–Ω–∫–∏.

**Phase 3 ‚Äî –î–∏–∞–ª–æ–≥–æ–≤—ã–π —Ñ–ª–æ—É**
- –†–µ–∫–æ–º–µ–Ω–¥—É—é FSM (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ `IkPosterStates`) –∏–∑‚Äë–∑–∞ 4 —à–∞–≥–æ–≤ –≤–≤–æ–¥–∞: `waiting_start_date ‚Üí waiting_days ‚Üí waiting_cover ‚Üí waiting_title ‚Üí generating`.
- –î–∞—Ç–∞: –ø–∞—Ä—Å–∏—Ç—å —á–µ—Ä–µ–∑ `parse_events_date` (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ ¬´2 –∞–≤–≥—É—Å—Ç–∞¬ª –∏ ISO), —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º‚Äë–ø–æ–¥—Å–∫–∞–∑–∫–æ–π —Ñ–æ—Ä–º–∞—Ç–∞.
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π: –ø—Ä–æ–≤–µ—Ä–∫–∞ `int` –∏ —Ä–∞–∑—É–º–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1‚Äì14/21).
- –û–±–ª–æ–∂–∫–∞: –ø—Ä–∏–Ω—è—Ç—å —Ñ–æ—Ç–æ/—Ñ–∞–π–ª, `extract_images` ‚Üí `upload_images(limit=1)`; —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å URL –≤ FSM.
- –ó–∞–≥–æ–ª–æ–≤–æ–∫: —Ç–µ–∫—Å—Ç; —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å; –ø–µ—Ä–µ–π—Ç–∏ –∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è: –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å, –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–±–æ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞; –ø—Ä–∏ —É–º–µ–Ω—å—à–µ–Ω–∏–∏ –¥–Ω–µ–π ‚Äî —Å–æ–æ–±—â–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, —á—Ç–æ –ø–µ—Ä–∏–æ–¥ —É–∫–æ—Ä–æ—á–µ–Ω –∏–∑‚Äë–∑–∞ –ª–∏–º–∏—Ç–∞.
- –í—ã—Ö–æ–¥: —Å–æ–∑–¥–∞—Ç—å Telegraph —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–µ—Ä–µ–∑ `telegraph_create_page`, –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É, –æ—á–∏—Å—Ç–∏—Ç—å FSM.
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è: –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ä–æ—É—Ç–µ—Ä `handlers/special_cmd.py` + `dp.include_router(...)` –≤ `create_app` (`main_part2.py`), —á—Ç–æ–±—ã –Ω–µ —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å –º–æ–Ω–æ–ª–∏—Ç.

- –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π –æ—Ç—á—ë—Ç: –≤—ã–±—Ä–∞–Ω FSM‚Äë–ø–æ–¥—Ö–æ–¥, –æ–ø–∏—Å–∞–Ω—ã —à–∞–≥–∏ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏, –º–µ—Å—Ç–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ä–æ—É—Ç–µ—Ä.

**Phase 4 ‚Äî build_special_page_content**
- –°–∏–≥–Ω–∞—Ç—É—Ä–∞: `build_special_page_content(db, start_date, days, cover_url, title, size_limit=TELEGRAPH_LIMIT)` ‚Üí `(title, content, size, used_days)`.
- –°–±–æ—Ä —Å–æ–±—ã—Ç–∏–π:
  - –û—Å–Ω–æ–≤–Ω—ã–µ: `Event.date in [start..end]`.
  - –í—ã—Å—Ç–∞–≤–∫–∏: `event_type == "–≤—ã—Å—Ç–∞–≤–∫–∞"` –∏ `end_date >= start` –∏ `date <= end` (–∫–∞–∫ –≤ weekend), –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–æ—á–Ω–æ–π –¥–∞—Ç—ã.
- –ü–µ—Ä–µ–¥ —Ä–µ–Ω–¥–µ—Ä–æ–º: `ensure_event_telegraph_link` –¥–ª—è —Å–æ–±—ã—Ç–∏–π –∏ –≤—ã—Å—Ç–∞–≤–æ–∫.
- –†–µ–Ω–¥–µ—Ä:
  - –û–±–ª–æ–∂–∫–∞ `figure/img` –ø–µ—Ä–≤–æ–π.
  - –ó–∞–≥–æ–ª–æ–≤–æ–∫ `h2` (—Ç–µ–∫—Å—Ç–æ–≤—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è).
  - –ë–ª–æ–∫–∏ –ø–æ –¥–Ω—è–º: `h3` —Å –¥–∞—Ç–æ–π, –∑–∞—Ç–µ–º –ø–æ –∫–∞–∂–¥–æ–º—É `SpecialEventGroup`:
    - `figure/img` –µ—Å–ª–∏ `photo_url`.
    - `h4` —Å —Å—Å—ã–ª–∫–æ–π –Ω–∞ `link_url` (–µ—Å–ª–∏ –µ—Å—Ç—å).
    - `p` —Å `description_or_digest`.
    - `p` —Å –ª–∏–Ω–∫–∞–º–∏ ¬´–ü–æ–¥—Ä–æ–±–Ω–µ–µ¬ª –∏ ¬´–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—å¬ª (–µ—Å–ª–∏ –µ—Å—Ç—å).
    - `p` —Å –¥–∞—Ç–æ–π (—Ñ–æ—Ä–º–∞—Ç `format_day_pretty`).
    - `p` –ø–æ –∫–∞–∂–¥–æ–π –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–µ `HH:MM ‚Äî –±–∏–ª–µ—Ç—ã/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è`.
    - `p` —Å –ª–æ–∫–∞—Ü–∏–µ–π `location_name, address, city`.
  - –í—ã—Å—Ç–∞–≤–∫–∏ –º–æ–∂–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å –ª–∏–±–æ –≤ –æ–±—â–∏–π –ø–æ—Ç–æ–∫ –ø–æ –¥–Ω—è–º, –ª–∏–±–æ –æ—Ç–¥–µ–ª—å–Ω—ã–º —Ä–∞–∑–¥–µ–ª–æ–º ¬´–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –≤—ã—Å—Ç–∞–≤–∫–∏¬ª ‚Äî —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ä–∞–∑–¥–µ–ª (–∫–∞–∫ –≤ weekend), —á—Ç–æ–±—ã –Ω–µ ¬´—Ä–∞–∑–º–∞–∑—ã–≤–∞—Ç—å¬ª –ø–æ –¥–∞—Ç–∞–º.
- –õ–∏–º–∏—Ç: —Ü–∏–∫–ª `while size > TELEGRAPH_LIMIT: days -= 1; rebuild`, –º–∏–Ω–∏–º–∞–ª—å–Ω–æ –¥–æ 1 –¥–Ω—è; –µ—Å–ª–∏ –¥–∞–∂–µ 1 –¥–µ–Ω—å –Ω–µ –≤–ª–µ–∑–∞–µ—Ç ‚Äî —Å–æ–æ–±—â–∏—Ç—å –∏/–∏–ª–∏ –∏—Å–∫–ª—é—á–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ —Ä–µ–Ω–¥–µ—Ä–∞ –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –ø–ª–∞–Ω.
- –í–æ–∑–≤—Ä–∞—Ç `used_days` –Ω—É–∂–µ–Ω, —á—Ç–æ–±—ã —Å–æ–æ–±—â–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, —á—Ç–æ –ø–µ—Ä–∏–æ–¥ —É–º–µ–Ω—å—à–µ–Ω.

- –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π –æ—Ç—á—ë—Ç: –æ–ø–∏—Å–∞–Ω –∞–ª–≥–æ—Ä–∏—Ç–º —Å–±–æ—Ä–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏ –ª–æ–≥–∏–∫–∞ —É–º–µ–Ω—å—à–µ–Ω–∏—è –ø–µ—Ä–∏–æ–¥–∞ –ø–æ –ª–∏–º–∏—Ç—É Telegraph.

**Phase 5 ‚Äî –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∞–≤—Ç–æ—Ç–µ—Å—Ç–∞–º**
- `test_special_dedup_same_title`: –¥–≤–∞ —Å–æ–±—ã—Ç–∏—è —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º `title` –∏ —Ä–∞–∑–Ω—ã–º `time` –≤ –æ–¥–∏–Ω –¥–µ–Ω—å ‚Üí –æ–¥–∏–Ω –±–ª–æ–∫ + –¥–≤–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏.
- `test_special_exhibitions_overlap`: –≤—ã—Å—Ç–∞–≤–∫–∞ —Å `end_date` –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –∫–æ–Ω—Ç–µ–Ω—Ç.
- `test_special_limit_shrinks_days`: –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ `TELEGRAPH_LIMIT` –¥–µ–Ω—å —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è; –º–æ–∂–Ω–æ –º–æ–∫–∞—Ç—å `rough_size` –∏–ª–∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –±–æ–ª—å—à–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è.
- `test_special_cover_first`: –æ–±–ª–æ–∂–∫–∞ ‚Äî –ø–µ—Ä–≤—ã–π —É–∑–µ–ª.
- `test_special_ticket_line_formats`: –±–µ—Å–ø–ª–∞—Ç–Ω–æ–µ/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/—Ü–µ–Ω–∞/–ø—Ä–æ–¥–∞–Ω–æ ‚Äî —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É—é—Ç—Å—è –∫—Ä–∞—Ç–∫–æ.
- –†–µ—Ñ–µ—Ä–µ–Ω—Å—ã –¥–ª—è –ø–æ–¥—Ö–æ–¥–æ–≤: `tests/test_bot.py` –∏ —Ç–µ—Å—Ç—ã –≤–æ–∫—Ä—É–≥ `build_weekend_page_content`/Telegraph (`tests/`).

- –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π –æ—Ç—á—ë—Ç: –æ–ø—Ä–µ–¥–µ–ª—ë–Ω –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤, –ø–æ–∫—Ä—ã–≤–∞—é—â–∏–π –¥–µ–¥—É–ø, –≤—ã—Å—Ç–∞–≤–∫–∏, –ª–∏–º–∏—Ç –∏ —Ä–µ–Ω–¥–µ—Ä.

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ, –º–æ–≥—É —Å–¥–µ–ª–∞—Ç—å: 1) —Å—Ö–µ–º—É FSM + –ø—Å–µ–≤–¥–æ–∫–æ–¥ –¥–ª—è `build_special_page_content`, 2) –≤–∞—Ä–∏–∞–Ω—Ç —Å —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–µ–∑ FSM (TTLCache), 3) –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã —Å—Ç—Ä–æ–∫ ¬´–±–∏–ª–µ—Ç—ã/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è¬ª.