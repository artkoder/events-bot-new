# Фаза 2 — Решение

## Решение
- Убрал fire-and-forget для `log_token_usage()`: теперь функция ожидает завершения вставки в Supabase.
- Это гарантирует, что запись не потеряется при завершении цикла/процесса и соответствует ожиданию `await log_token_usage()` у вызывающих функций.

## Что изменено
- `main.py`: заменён `asyncio.create_task(_log())` на `await _log()`.
- `main.py`: debug-сообщение обновлено с `scheduling` на `start`, чтобы соответствовать новой семантике.

## Риск-оценка
- Потенциально добавляет ожидание на запись в Supabase (в фоне через `asyncio.to_thread`), но вызовы уже были `await`-ными и логирование критично для учёта токенов.
