---
description: Основные инструкции для AI-агента при работе с проектом
---

# Общие правила

1. **Язык ответов** — всегда отвечай на русском языке
2. **Автотесты** — генерируй unit-тесты при решении задач (pytest)
3. **Документация** — обновляй README.md и docs/ при изменении функционала
4. **Changelog** — заноси все изменения в CHANGELOG.md в секцию [Unreleased]
5. **Версионирование** — при релизе обновляй VERSION и создавай git tag

# Git workflow: ветка dev

> ⚠️ **ВАЖНО**: Все изменения сначала коммитятся в ветку `dev`, а не в `main`!

## Автоматические коммиты в dev

После каждого завершённого исправления или добавления функционала:

1. Переключись на ветку `dev` (создай если не существует):
   ```bash
   git checkout dev 2>/dev/null || git checkout -b dev
   ```

2. Закоммить изменения с понятным сообщением:
   ```bash
   git add -A && git commit -m "тип: краткое описание"
   ```
   Типы: `fix`, `feat`, `refactor`, `docs`, `test`, `chore`

3. Запуш в remote для сохранности:
   ```bash
   git push origin dev
   ```

Это гарантирует, что код не потеряется даже при недоступности codespace.

## При релизе на прод

Ветка `dev` мержится в `main` только при команде `/release`:

1. Переключись на main: `git checkout main`
2. Смерж dev: `git merge dev`
3. Выполни шаги релиза (см. ниже)
4. После успешного релиза можно удалить dev: `git branch -d dev`

# Версионирование (SemVer)

Формат: `MAJOR.MINOR.PATCH`

- **MAJOR** — несовместимые изменения API, крупные рефакторинги
- **MINOR** — новый функционал с сохранением совместимости
- **PATCH** — багфиксы и мелкие улучшения

## Обязательные шаги при релизе на прод:

1. Определи тип изменений (major/minor/patch)
2. Обнови файл `VERSION` с новой версией
3. Перенеси секцию [Unreleased] в CHANGELOG → `[X.Y.Z] – YYYY-MM-DD`
4. Создай новую пустую секцию [Unreleased]
5. Закоммить все изменения: `git add -A && git commit -m "chore: release vX.Y.Z"`
6. **Создай git tag**: `git tag -a vX.Y.Z -m "Release vX.Y.Z"`
7. **Запуш с тегами**: `git push origin main --tags`
8. **Деплой на Fly.io**: `fly deploy` (ТОЛЬКО ПО КОМАНДЕ ПОЛЬЗОВАТЕЛЯ!)

> ⚠️ **ВАЖНО**: Git tag ОБЯЗАТЕЛЕН! Без тега релиз не считается завершённым.

# Структура проекта

- `video_announce/` — видео-анонсы (сессии, паттерны, превью)
- `kaggle/VideoAfisha/` — Kaggle notebook для рендеринга
- `docs/` — документация проекта
- `tests/` — автотесты (pytest)
