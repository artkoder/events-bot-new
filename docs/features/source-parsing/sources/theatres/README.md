# –¢–µ–∞—Ç—Ä—ã: –ø–∞—Ä—Å–∏–Ω–≥ —Å–æ–±—ã—Ç–∏–π (/parse)

## –û–±–∑–æ—Ä

–ö–æ–º–∞–Ω–¥–∞ `/parse` –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–∞—Ä—Å–∏–Ω–≥ —Å–æ–±—ã—Ç–∏–π –∏–∑ —Ç–µ–∞—Ç—Ä–æ–≤ (–î—Ä–∞–º—Ç–µ–∞—Ç—Ä, –ú—É–∑—Ç–µ–∞—Ç—Ä, –ö–∞—Ñ–µ–¥—Ä–∞–ª—å–Ω—ã–π —Å–æ–±–æ—Ä, –¢—Ä–µ—Ç—å—è–∫–æ–≤–∫–∞) —á–µ—Ä–µ–∑ Kaggle-–Ω–æ—É—Ç–±—É–∫.

–¢–∞–∫–∂–µ –¥–æ—Å—Ç—É–ø–µ–Ω –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º: `/parse check` (–∑–∞–ø—É—Å–∫ –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î).

## –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–æ–±—ã—Ç–∏–π

–ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–±—ã—Ç–∏—è –∏–∑ JSON –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–∏—Å–∫ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:

```
find_existing_event(location, date, time, title)
```

### –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∏—Å–∫–∞

1. **–ü–æ–∏—Å–∫ –ø–æ location + date** ‚Äî –Ω–∞—Ö–æ–¥–∏–º –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –≤ —Ç–æ–π –∂–µ –ª–æ–∫–∞—Ü–∏–∏ –Ω–∞ —Ç—É –∂–µ –¥–∞—Ç—É
2. **Fuzzy match –ø–æ title** ‚Äî —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏—è (–ø–æ—Ä–æ–≥ 85%)
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏**:
   - –ï—Å–ª–∏ –≤ –ë–î –≤—Ä–µ–º—è `00:00` (placeholder) ‚Üí **–ø–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** —Å–æ–±—ã—Ç–∏—è
   - –ï—Å–ª–∏ –≤—Ä–µ–º—è —Å–æ–≤–ø–∞–¥–∞–µ—Ç ‚Üí **–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –±–∏–ª–µ—Ç–æ–≤**
   - –ï—Å–ª–∏ –≤—Ä–µ–º—è —Ä–∞–∑–Ω–æ–µ ‚Üí —Å–æ–±—ã—Ç–∏–µ –ù–ï —Å–æ–≤–ø–∞–¥–∞–µ—Ç

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏

| –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|
| ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ | –ù–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ, —Å–æ–∑–¥–∞–Ω–æ –≤ –ë–î |
| üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–æ | –ù–∞–π–¥–µ–Ω–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ, –æ–±–Ω–æ–≤–ª—ë–Ω —Å—Ç–∞—Ç—É—Å –±–∏–ª–µ—Ç–æ–≤ |
| ‚ùå –û—à–∏–±–æ–∫ | –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ |
| ‚è≠Ô∏è –ü—Ä–æ–ø—É—â–µ–Ω–æ | –°–æ–±—ã—Ç–∏–µ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —á–µ—Ä–µ–∑ `upsert_event` |

## –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö

| –ò—Å—Ç–æ—á–Ω–∏–∫ | –§–∞–π–ª JSON | –õ–æ–∫–∞—Ü–∏—è –≤ –ë–î |
|----------|-----------|--------------|
| dramteatr | dramteatr.json | –î—Ä–∞–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ–∞—Ç—Ä |
| muzteatr | muzteatr.json | –ú—É–∑—ã–∫–∞–ª—å–Ω—ã–π —Ç–µ–∞—Ç—Ä |
| sobor | sobor.json | –ö–∞—Ñ–µ–¥—Ä–∞–ª—å–Ω—ã–π —Å–æ–±–æ—Ä |
| tretyakov | tretyakov.json | –¢—Ä–µ—Ç—å—è–∫–æ–≤—Å–∫–∞—è –≥–∞–ª–µ—Ä–µ—è |

## –ß—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏

–ü—Ä–∏ `ticket_updated`:
- `ticket_status` (available/sold_out)
- `ticket_link` (–µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª)

–ü—Ä–∏ `needs_full_update`:
- `time`
- `ticket_status`, `ticket_link`
- `pushkin_card`
- `description` (–µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª)
- `photo_urls` (–µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏)

## –í–ª–∏—è–Ω–∏–µ –Ω–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –∞–Ω–æ–Ω—Å

- **–ù–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è** (`new_added`) ‚Üí –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ –∞–Ω–æ–Ω—Å–µ "–î–û–ë–ê–í–ò–õ–ò –í –ê–ù–û–ù–°"
- **–û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è** (`ticket_updated`) ‚Üí –ù–ï –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ –∞–Ω–æ–Ω—Å–µ (–Ω–µ –º–µ–Ω—è–µ—Ç—Å—è `added_at`)

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

–î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –≤–∫–ª—é—á–∏—Ç–µ –ª–æ–≥–∏:
```bash
export LOG_LEVEL=DEBUG
```

–õ–æ–≥–∏ –ø–æ–∫–∞–∂—É—Ç:
- `find_existing_event: MATCHED` ‚Äî —Å–æ–±—ã—Ç–∏–µ –Ω–∞–π–¥–µ–Ω–æ
- `find_existing_event: NO MATCH` ‚Äî —Å–æ–±—ã—Ç–∏–µ –Ω–æ–≤–æ–µ

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- –û–±—â–∏–π –∏–Ω–¥–µ–∫—Å —Ñ–∏—á–∏: `docs/features/source-parsing/README.md`
- Pyramida: `docs/features/source-parsing/sources/pyramida/README.md`
